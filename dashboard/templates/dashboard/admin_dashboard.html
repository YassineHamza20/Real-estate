<!-- templates/dashboard/admin_dashboard.html - PROFESSIONAL MULTI-CHART -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Analytics Dashboard</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}">
    
    <!-- Professional Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        'primary-dark': '#1d4ed8',
                        secondary: '#10b981',
                        'secondary-dark': '#047857',
                        accent: '#0ea5e9',
                        'accent-dark': '#0369a1',
                        neutral: '#6b7280',
                        'neutral-dark': '#374151'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="dashboard-bg">
    <!-- Professional Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="animate-slide-in-left">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                                <span class="text-white font-semibold text-sm">RE</span>
                            </div>
                            <div>
                                <h1 class="text-xl font-semibold text-gray-900">Real Estate Analytics</h1>
                                <p class="text-sm text-neutral">Professional Dashboard</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="hidden md:flex items-center space-x-1 text-sm text-neutral">
                        <span>Last updated:</span>
                        <span id="current-time" class="font-medium">{{ current_time }}</span>
                    </div>
                    <div class="flex space-x-2">
                        <a href="/admin/" class="btn-primary text-sm font-medium">
                            Admin Panel
                        </a>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- KPI Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Users -->
            <div class="metric-card animate-fade-in-up">
                <div class="flex justify-between items-start mb-4">
                    <div class="text-neutral text-sm font-medium">Total Users</div>
                    <div class="text-primary text-lg">üë•</div>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-2">{{ total_users }}</div>
                <div class="text-xs text-neutral">Registered Users</div>
            </div>

            <!-- Total Properties -->
            <div class="metric-card animate-fade-in-up" style="animation-delay: 0.1s;">
                <div class="flex justify-between items-start mb-4">
                    <div class="text-neutral text-sm font-medium">Properties</div>
                    <div class="text-secondary text-lg">üè†</div>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-2">{{ total_properties }}</div>
                <div class="text-xs text-neutral">Listed Properties</div>
            </div>

            <!-- Active Sellers -->
            <div class="metric-card animate-fade-in-up" style="animation-delay: 0.2s;">
                <div class="flex justify-between items-start mb-4">
                    <div class="text-neutral text-sm font-medium">Active Sellers</div>
                    <div class="text-accent text-lg">üíº</div>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-2">{{ total_sellers }}</div>
                <div class="text-xs text-neutral">Verified Partners</div>
            </div>

            <!-- Wishlist Engagement -->
            <div class="metric-card animate-fade-in-up" style="animation-delay: 0.3s;">
                <div class="flex justify-between items-start mb-4">
                    <div class="text-neutral text-sm font-medium">Wishlist Saves</div>
                    <div class="text-pink-500 text-lg">‚ù§Ô∏è</div>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-2">{{ total_wishlists }}</div>
                <div class="text-xs text-neutral">Total Saves</div>
            </div>
        </div>

        <!-- Multi-Chart Section -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
            <!-- User Analytics -->
            <div class="space-y-8">
                <!-- User Distribution - Doughnut Chart -->
                <div class="chart-container rounded-xl p-6 animate-scale-in">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">User Distribution</h3>
                    <canvas id="usersChart" class="compact-chart w-full"></canvas>
                </div>

                <!-- Monthly User Growth - Line Chart -->
                <div class="chart-container rounded-xl p-6 animate-scale-in" style="animation-delay: 0.1s;">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">User Growth Trend</h3>
                    <canvas id="growthChart" class="medium-chart w-full"></canvas>
                </div>
            </div>

            <!-- Property Analytics -->
            <div class="space-y-8">
                <!-- Property Types - Pie Chart -->
                <div class="chart-container rounded-xl p-6 animate-scale-in">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Property Types</h3>
                    <canvas id="propertiesChart" class="compact-chart w-full"></canvas>
                </div>

                <!-- Price Distribution - Bar Chart -->
                <div class="chart-container rounded-xl p-6 animate-scale-in" style="animation-delay: 0.1s;">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Price Distribution</h3>
                    <canvas id="priceChart" class="medium-chart w-full"></canvas>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Verification Status - Horizontal Bar Chart -->
            <div class="chart-container rounded-xl p-6 animate-fade-in-up">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Verification Status</h3>
                <canvas id="verificationChart" class="compact-chart w-full"></canvas>
            </div>

            <!-- Properties by City - Bar Chart -->
            <div class="chart-container rounded-xl p-6 animate-fade-in-up" style="animation-delay: 0.1s;">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Properties by City</h3>
                <canvas id="citiesChart" class="compact-chart w-full"></canvas>
            </div>

            <!-- Room Distribution - Radar Chart -->
            <div class="chart-container rounded-xl p-6 animate-fade-in-up" style="animation-delay: 0.2s;">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Room Distribution</h3>
                <canvas id="roomsChart" class="compact-chart w-full"></canvas>
            </div>
        </div>

        <!-- Data Tables Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Recent Properties with Wishlist Count -->
            <div class="chart-container rounded-xl p-6 animate-fade-in-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Recent Properties</h3>
                    <span class="text-xs text-neutral bg-gray-100 px-2 py-1 rounded">Latest Listings</span>
                </div>
                <div class="data-grid rounded-lg overflow-hidden">
                    {% for property in recent_properties_list %}
                    <div class="data-row">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-gray-900 text-sm truncate">{{ property.name }}</div>
                                <div class="text-xs text-neutral">by {{ property.seller.username }} ‚Ä¢ {{ property.city }}</div>
                            </div>
                            <div class="flex items-center space-x-3 ml-4">
                                <span class="text-secondary font-semibold text-sm whitespace-nowrap">{{ property.price }} euros</span>
                                <div class="flex items-center space-x-1 text-xs text-neutral">
                                    <span>‚ù§Ô∏è</span>
                                    <span>{{ property.wishlisted_by.count }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="data-row text-center text-neutral py-4">No recent properties</div>
                    {% endfor %}
                </div>
            </div>

            <!-- Most Wishlisted Properties -->
            <div class="chart-container rounded-xl p-6 animate-fade-in-up" style="animation-delay: 0.1s;">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Most Popular</h3>
                    <span class="text-xs text-neutral bg-gray-100 px-2 py-1 rounded">By Wishlists</span>
                </div>
                <div class="data-grid rounded-lg overflow-hidden">
                    {% for property in most_wishlisted %}
                    <div class="data-row">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-gray-900 text-sm truncate">{{ property.name }}</div>
                                <div class="text-xs text-neutral">{{ property.city }} ‚Ä¢ {{ property.property_type }}</div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="bg-pink-500 text-white px-2 py-1 rounded text-xs font-medium">
                                    {{ property.wishlist_count }} saves
                                </span>
                                <span class="text-secondary font-semibold text-sm whitespace-nowrap">
                                    {{ property.price }} euros
                                </span>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="data-row text-center text-neutral py-4">No wishlisted properties</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced JavaScript with Multiple Chart Types -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update current time
            function updateTime() {
                const now = new Date();
                document.getElementById('current-time').textContent = now.toLocaleTimeString();
            }
            updateTime();
            setInterval(updateTime, 60000);

            // Professional color palette (No purple)
            const colors = ['#3b82f6', '#10b981', '#0ea5e9', '#6b7280', '#f59e0b', '#ef4444'];

            // 1. User Distribution - Doughnut Chart
            new Chart(document.getElementById('usersChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Buyers', 'Sellers', 'Admins'],
                    datasets: [{
                        data: [{{ total_buyers }}, {{ total_sellers }}, 1],
                        backgroundColor: [colors[0], colors[1], colors[2]],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { 
                                font: { size: 11, family: 'Inter' },
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });

            // 2. User Growth Trend - Line Chart
            new Chart(document.getElementById('growthChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'User Growth',
                        data: [5, 8, 12, 9, 15, 20],
                        borderColor: colors[0],
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // 3. Property Types - Pie Chart
            new Chart(document.getElementById('propertiesChart'), {
                type: 'pie',
                data: {
                    labels: ['Villas', 'Apartments', 'Houses', 'Commercial', 'Land'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: [colors[0], colors[1], colors[2], colors[3], colors[4]],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { 
                                font: { size: 11, family: 'Inter' },
                                padding: 20
                            }
                        }
                    }
                }
            });

            // 4. Price Distribution - Bar Chart
            new Chart(document.getElementById('priceChart'), {
                type: 'bar',
                data: {
                    labels: ['0-500K', '500K-1M', '1M-2M', '2M-5M', '5M+'],
                    datasets: [{
                        label: 'Properties',
                        data: [25, 40, 20, 10, 5],
                        backgroundColor: colors[1],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // 5. Verification Status - Horizontal Bar Chart
            new Chart(document.getElementById('verificationChart'), {
                type: 'bar',
                data: {
                    labels: ['Verified', 'Pending', 'Not Submitted'],
                    datasets: [{
                        data: [
                            {{ verified_sellers }}, 
                            {{ pending_verifications }}, 
                            {{ total_sellers }} - {{ verified_sellers }} - {{ pending_verifications }}
                        ],
                        backgroundColor: [colors[1], colors[4], colors[3]],
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // 6. Properties by City - Bar Chart
            const cityLabels = [{% for city in popular_cities %}'{{ city.city|default:"Unknown" }}',{% endfor %}];
            const cityData = [{% for city in popular_cities %}{{ city.count }},{% endfor %}];
            
            new Chart(document.getElementById('citiesChart'), {
                type: 'bar',
                data: {
                    labels: cityLabels,
                    datasets: [{
                        data: cityData,
                        backgroundColor: colors[0],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // 7. Room Distribution - Radar Chart
            new Chart(document.getElementById('roomsChart'), {
                type: 'radar',
                data: {
                    labels: ['1 Room', '2 Rooms', '3 Rooms', '4 Rooms', '5+ Rooms'],
                    datasets: [{
                        label: 'Properties',
                        data: [10, 25, 40, 20, 5],
                        backgroundColor: 'rgba(14, 165, 233, 0.2)',
                        borderColor: colors[2],
                        pointBackgroundColor: colors[2],
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: colors[2]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>